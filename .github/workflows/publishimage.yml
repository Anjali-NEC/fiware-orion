name: Publish Snapshot Image from master

on:
  push:
#    branches:
#      - master

jobs:
  deploy-release:

    runs-on: ubuntu-18.04
    if: github.event_name == 'push'

    steps:

    - name: Get Latest Release
      id: latest_version
      uses: abatilo/release-info-action@v1.3.0
      with:
        owner: telefonicaid
        repo: fiware-orion

    - name: Echo version
      run: |
        echo "Version ${{ steps.latest_version.outputs.latest_tag }}"

    - name: Increment version
      id: increment-semver-minor
      env:
        LATEST_RELEASE: ${{ steps.latest_version.outputs.latest_tag }}
      run: |
        version=$LATEST_RELEASE
        a=( ${version//./ } )
        ((a[1]++))
        a[2]=0
        echo "${a[0]}.${a[1]}.${a[2]}"
        version=$(echo "${a[0]}.${a[1]}.${a[2]}")
        echo "::set-output name=version::${version}"


    - name: Get the output version
      run: |
        echo "The new minor version was ${{ steps.increment-semver-minor.outputs.version }}"
